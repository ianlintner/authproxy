---
apiVersion: v1
kind: Service
metadata:
  name: oauth2-proxy
  namespace: auth
  labels:
    app: oauth2-proxy
    app.kubernetes.io/name: oauth2-proxy
    app.kubernetes.io/component: authentication
spec:
  type: ClusterIP
  selector:
    app: oauth2-proxy
  ports:
  - name: http
    port: 4180
    targetPort: http
    protocol: TCP
  - name: metrics
    port: 44180
    targetPort: metrics
    protocol: TCP
  sessionAffinity: None
---
# Service for ext_authz (Istio will call this for auth checks)
# Points to the same oauth2-proxy but makes intent clear
apiVersion: v1
kind: Service
metadata:
  name: oauth2-proxy-extauthz
  namespace: auth
  labels:
    app: oauth2-proxy
    app.kubernetes.io/name: oauth2-proxy
    app.kubernetes.io/component: ext-authz
spec:
  type: ClusterIP
  selector:
    app: oauth2-proxy
  ports:
  - name: http-authz
    port: 4180
    targetPort: http
    protocol: TCP
