---
apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-templates
  namespace: default
  labels:
    app: oauth2-proxy
    app.kubernetes.io/name: oauth2-proxy
    app.kubernetes.io/component: authentication
data:
  # Custom HTML templates for oauth2-proxy login & error pages
  # Reference: https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview#custom-templates
  sign_in.html: |
    <!DOCTYPE html>
    <html lang="en" class="h-full dark">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Sign in â€¢ Cat Herding SSO</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <script>
        // Default to dark mode unless user explicitly chose light
        const userPref = localStorage.getItem('theme');
        if (!userPref) { localStorage.setItem('theme','dark'); }
        if (userPref !== 'light') document.documentElement.classList.add('dark');
      </script>
      <style>
        .provider-btn { transition: all .15s ease; }
        .provider-btn:hover { transform: translateY(-2px); }
      </style>
    </head>
    <body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex items-center justify-center p-6">
      <div class="w-full max-w-xl">
        <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700">
          <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <div class="h-10 w-10 rounded-lg bg-indigo-600 flex items-center justify-center text-white font-bold">CH</div>
              <div>
                <h1 class="text-lg font-semibold">Cat Herding SSO</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400">Secure Single Sign-On for *.cat-herding.net</p>
              </div>
            </div>
            <button id="themeToggle" class="text-sm px-3 py-1 rounded-md border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600" aria-label="Toggle dark mode">ðŸŒ“</button>
          </div>
          <div class="px-8 py-8">
            <h2 class="text-xl font-medium mb-2">Sign in to continue</h2>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Choose a provider to authenticate. Once signed in, your session works across all applications under the cat-herding.net domain.</p>
            <div class="grid grid-cols-1 gap-4">
              <!-- GitHub Provider (active) -->
              <a href="/oauth2/start" class="provider-btn group flex items-center justify-between px-5 py-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-750 hover:border-indigo-500 dark:hover:border-indigo-400">
                <div class="flex items-center space-x-4">
                  <svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M12 .5C5.65.5.5 5.65.5 12c0 5.08 3.29 9.38 7.86 10.9.58.11.79-.25.79-.56 0-.27-.01-1.16-.02-2.1-3.2.7-3.88-1.37-3.88-1.37-.53-1.33-1.3-1.68-1.3-1.68-1.06-.73.08-.72.08-.72 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.74 1.27 3.4.97.1-.76.41-1.27.74-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.29 1.2-3.09-.12-.29-.52-1.46.11-3.04 0 0 .97-.31 3.18 1.18a11.1 11.1 0 0 1 2.9-.39c.98.01 1.97.13 2.9.39 2.2-1.49 3.17-1.18 3.17-1.18.63 1.58.23 2.75.11 3.04.75.8 1.2 1.83 1.2 3.1 0 4.43-2.69 5.4-5.25 5.68.42.36.79 1.08.79 2.18 0 1.57-.01 2.83-.01 3.21 0 .31.21.68.8.56A10.52 10.52 0 0 0 23.5 12C23.5 5.65 18.35.5 12 .5Z" clip-rule="evenodd"/></svg>
                  <div>
                    <p class="font-medium">Continue with GitHub</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Developer identity & teams</p>
                  </div>
                </div>
                <div class="opacity-0 group-hover:opacity-100 text-indigo-600 dark:text-indigo-400 text-xs font-semibold">â†’</div>
              </a>
              <!-- Placeholder buttons for future providers -->
              <button disabled class="provider-btn flex items-center justify-between px-5 py-4 rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 cursor-not-allowed">
                <div class="flex items-center space-x-4 opacity-60">
                  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg" alt="Google" class="w-8 h-8"/>
                  <div>
                    <p class="font-medium">Google (coming soon)</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Personal & workspace accounts</p>
                  </div>
                </div>
              </button>
              <button disabled class="provider-btn flex items-center justify-between px-5 py-4 rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 cursor-not-allowed">
                <div class="flex items-center space-x-4 opacity-60">
                  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/microsoft/microsoft-original.svg" alt="Microsoft" class="w-8 h-8"/>
                  <div>
                    <p class="font-medium">Microsoft (coming soon)</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Azure AD / Entra ID</p>
                  </div>
                </div>
              </button>
              <button disabled class="provider-btn flex items-center justify-between px-5 py-4 rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 cursor-not-allowed">
                <div class="flex items-center space-x-4 opacity-60">
                  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn" class="w-8 h-8"/>
                  <div>
                    <p class="font-medium">LinkedIn (coming soon)</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Professional identity</p>
                  </div>
                </div>
              </button>
            </div>
            <div class="mt-8 text-xs text-gray-500 dark:text-gray-400 flex flex-col space-y-2">
              <p>By continuing you agree to the unified Cat Herding SSO session. This grants access to all applications you are authorized for under this domain.</p>
              <p>Need another provider? <span class="text-indigo-600 dark:text-indigo-400 font-medium">Request access</span>.</p>
            </div>
          </div>
        </div>
        <p class="mt-6 text-center text-xs text-gray-400">Â© <span id="year"></span> Cat Herding Network</p>
      </div>
      <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        document.getElementById('themeToggle').addEventListener('click', () => {
          const root = document.documentElement;
          const isDark = root.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
      </script>
    </body>
    </html>
  error.html: |
    <!DOCTYPE html>
    <html lang="en" class="h-full dark">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Error â€¢ Cat Herding SSO</title>
      <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="h-full bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-6">
      <div class="max-w-lg w-full bg-white dark:bg-gray-800 shadow-lg rounded-xl p-8 border border-gray-200 dark:border-gray-700">
        <h1 class="text-2xl font-semibold mb-2 text-red-600 dark:text-red-400">Authentication Error</h1>
        <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">An issue occurred while processing your sign in request.</p>
        <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg p-4 mb-6">
          <p class="text-xs font-mono text-red-700 dark:text-red-300">{{.Error}}</p>
        </div>
        <div class="flex flex-col space-y-3 text-sm">
          <a href="/oauth2/start" class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-500">Try Again</a>
          <a href="/" class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600">Return Home</a>
        </div>
        <p class="mt-6 text-xs text-gray-400">If the problem persists, contact support.</p>
      </div>
    </body>
    </html>