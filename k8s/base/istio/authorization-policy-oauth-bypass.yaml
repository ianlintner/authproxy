---
# AuthorizationPolicy to bypass ext_authz for oauth2-proxy's own endpoints
# This ensures /oauth2/* paths on auth.cat-herding.net are NOT intercepted by the ext_authz filter
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: oauth2-proxy-bypass
  namespace: aks-istio-ingress
  labels:
    app.kubernetes.io/name: oauth2-proxy-bypass
    app.kubernetes.io/component: authentication
spec:
  # Apply to the ingress gateway
  selector:
    matchLabels:
      istio: aks-istio-ingressgateway-external
  
  # ALLOW action - allow all traffic through gateway
  action: ALLOW
  
  rules:
  # Allow all traffic
  - {}
